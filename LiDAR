#include <RPLidar.h) // include library for LiDAR sensor
#define RPLIDAR_MOTOR 3 // The PWM pin for control the speed of RPLIDAR's motor (MOTOCTRL).

RPLidar lidar;

void setup() {
  Serial.begin(115200); // Set up Buad rate
  lidar.begin(Serial); // Write distance values to serial
  pinMode(RPLIDAR_MOTOR, OUTPUT); //set pin mode

}

f
void loop() {
  if (IS_OK(lidae.waitPoint())) {
    float distance = lidar.getCurrentPoint().distance; // get the distance to nearest object
    float angle = lidar.getCurrentPoint().angle; //Get angle of lidar sensor 0-360 degrees
    Serial.print(distance, 6); // Print Distance
    Serial.print('\n'); // new line
    Serial.print(angle, 6); // Print angle
    Serial.print('\n'); // new line
  }
  else {
    analogWrite(RPLIDAR_MOTOR, 0); //stop the rplidar motor
    // Try to dectect the LIDAR
    rplidar_response_device_info_t info;
    if (IS_OK(lidar.getDeviceInfo(info, 100))) { // if the motor is detected
       lidar.startScan(); // resart liDAR scanning
       analogWrite(RPLIDAR_MOTOR, 255); // Begin driving the motor again
       delay(1000);
  }
}
